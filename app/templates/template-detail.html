<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Template</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>

<body class="app-shell" data-theme="{{ theme_mode or 'light' }}">
<header class="app-top-bar">
  <div class="container d-flex align-items-center justify-content-between">
    <a class="app-brand" href="{{ url_for('main.home') }}"></a>
    <div class="app-actions">
      <button type="button" class="theme-toggle btn btn-sm btn-outline-light">
        <span class="theme-toggle-label">{{ 'Light mode' if theme_mode == 'dark' else 'Dark mode' }}</span>
      </button>

      {% if current_user.is_authenticated %}
        <span class="app-role-label">{{ current_user.role|capitalize }}</span>
      {% endif %}
      <a href="{{ url_for('auth.logout') }}" class="app-logout-link">Log out</a>
    </div>
  </div>
</header>

<div class="container mt-5 mb-5">

  <!-- Template settings -->
  <div class="template-editor-panel">
    <div class="template-editor-header d-flex flex-column flex-lg-row align-items-lg-center gap-3">
      <div class="flex-grow-1 w-100">
        <h1 class="h3 mb-2">Manage Template</h1>

        <form class="row g-3 align-items-end" method="POST">
          <input type="hidden" name="action" value="update_template"/>

          <div class="col-12 col-md-6 col-lg-5">
            <label class="form-label">Template Name</label>
            <input type="text" name="name" class="form-control" value="{{ template.name }}" required/>
          </div>

          <div class="col-12 col-md-6 col-lg-5">
            <label class="form-label">Description</label>
            <input type="text" name="description" class="form-control"
                   value="{{ template.description or '' }}" placeholder="Optional"/>
          </div>

          <div class="col-12 col-md-6 col-lg-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Save</button>
          </div>
        </form>

      </div>

      {% if current_user.role == 'trainer' %}
        <a href="{{ url_for('template.assign_template', template_id=template.id) }}"
           class="btn btn-outline-primary btn-sm">Assign Template</a>
      {% endif %}
    </div>

    <!-- Search from catalog -->
    <div class="card template-search-card mt-4">
      <div class="card-body">
        <h5 class="card-title">Search & Add Exercises</h5>
        <p class="text-muted small">Type to search exercises and add them to the template.</p>

        <input type="text" id="exerciseSearch" class="form-control" placeholder="e.g. squat, bench press">
        <div id="searchResults" class="list-group mt-2" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Manual add -->
  <div class="card mb-4 mt-4">
    <div class="card-body">
      <h5 class="card-title">Add Manually</h5>
      <div class="row g-2 align-items-end">
        <div class="col-md-8">
          <label class="form-label">Exercise Name</label>
          <input type="text" id="manualExerciseName" class="form-control">
        </div>

        <div class="col-md-4">
          <button type="button" id="manualAddBtn" class="btn btn-success w-100">Add Exercise</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Current exercises -->
  <h4>Current Exercises:</h4>

  <ul class="list-group" id="currentExercises">

    {% for ex in template.exercises %}
      {% set cat = catalog_map.get(ex.exercise_name) %}

      <li class="list-group-item d-flex justify-content-between align-items-center">

        <span>
          {{ ex.exercise_name }}
          {% if ex.muscle %}
            <span class="text-muted small">— {{ ex.muscle }}</span>
          {% endif %}
        </span>

        <!-- Modal trigger -->
        <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modal{{ loop.index }}">
          Info
        </button>

        <!-- Modal -->
      <div class="modal fade" id="modal{{ loop.index }}" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">{{ ex.exercise_name }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body text-dark">    <!--  <-- makes text BLACK -->

        {% if cat %}

          {# ————— IMAGE ————— #}
          {% if cat.local_image_main %}
            <img src="{{ url_for('static', filename=cat.local_image_main) }}"
                 class="img-fluid rounded mb-3"
                 alt="Exercise image">
          {% else %}
            <p class="text-muted">No image available.</p>
          {% endif %}

          {# ————— INSTRUCTIONS ————— #}
          {% if cat.instructions %}
            <pre class="text-wrap text-dark" style="white-space: pre-line;">
{{ cat.instructions }}
            </pre>
          {% else %}
            <p class="text-muted">No instructions available.</p>
          {% endif %}

        {% else %}
          <p class="text-muted">No info stored for this exercise.</p>
        {% endif %}

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>


      </li>

    {% else %}
      <li class="list-group-item text-muted">No exercises added yet.</li>
    {% endfor %}

  </ul>

</div>

{% include '_bottom_nav.html' %}

<script src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>

<!-- Bootstrap JS REQUIRED FOR MODALS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Your search/add JS remains unchanged -->
<script>
  /* your existing JS left untouched */
</script>

</body>
</html>
